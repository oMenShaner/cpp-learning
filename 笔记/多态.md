# 一、多态
## 多态的概念
> 多态(ploymorphism)：通俗来说，就是多种形态。

**多态**分为编译时多态（静态多态）和运行时多态（动态多态）。

- **编译时多态**主要是**函数重载**和**函数模板**，通过传达不同的参数，以做到同一个函数名表达不同形态，由于将实参传递给形参的参数匹配是在编译时完成的，所以叫做编译时多态。
- **运行时多态**，具体点就是去完成某个行为（函数），可以传不同的对象就会完成不同的行为，由此达到多种形态。譬如买票这个行为，普通人是全价买票，学生是优惠买票，军人则是优先买票。

## 多态的定义及实现
> 多态是在不同继承关系的类对象，去调用同一函数，产生了不同的行为。

针对上面买票的例子，创建三个类，`Student`和`Soldier`继承自`Person`：

```cpp
class Person {};
class Student : public Person {};
class Soldier : public Person {};
```
对于买票这个行为，创建函数`BuyTicket`
```cpp
void BuyTicket();
```

为了实现多态，需要先将基类的`BuyTicket`通过`virtual`关键字定义成**虚函数**（非成员函数不能加`virtual`进行修饰），同时派生类的`BuyTicket`做到**返回值类型、函数名字、参数列表完全相同**，达到**重写**的效果：
```cpp
class Person {
public:
    // 添加virtual关键字
    virtual void BuyTicket()
    {
        cout << "全价买票" << endl;
    }
};
class Student : public Person {
public:
    // 派生类保持返回值类型，函数名及参数列表完全相同，才可以达到重写
    virtual void BuyTicket()
    {
        cout << "半价买票" << endl;
    }
};
class Soldier : public Person {
public:
    virtual void BuyTicket()
    {
        cout << "优先买票" << endl;
    }
};
```
自此，完成继承中构成多态的一个条件：**被调用的函数必须是虚函数，并且派生类必须对基类的虚函数进行重写。**

> 重写也称覆盖，是派生类对基类允许访问的方法的**实现过程**进行重新改写，返回值类型、函数名称及参数列表都不能改变。

接着设计一个`Pay`函数，通过接收不同的身份来调用不同的`BuyTicket`函数，调用虚函数需要用到**指针**或**引用**：
```cpp
// 调用虚函数必须通过指针或引用
void Pay(Person* ptr)
{
    // 虽然都是Person指针ptr在调用BuyTicket
    // 但是跟ptr没关系，而是由ptr指向的对象决定的
    ptr->BuyTicket();
}
```
这是构成**多态**的第二个条件：必须通过**基类的指针**或**引用**调用**基函数**。

下面的程序展示了如何实现**多态**：
```cpp
class Person {
public:
    // 添加virtual关键字
    virtual void BuyTicket()
    {
        cout << "全价买票" << endl;
    }
};
class Student : public Person {
public:
    // 派生类保持返回值类型，函数名及参数列表完全相同，才可以达到重写
    virtual void BuyTicket()
    {
        cout << "半价买票" << endl;
    }
};
class Soldier : public Person {
public:
    virtual void BuyTicket()
    {
        cout << "优先买票" << endl;
    }
};

// 调用虚函数必须通过指针或引用
void Pay(Person* ptr)
{
    ptr->BuyTicket();
}

int main()
{
    Person p;
    Student st;
    Soldier so;

    Pay(&p);
    Pay(&st);
    Pay(&so);

    return 0;
}
```
程序运行结果如下：
![alt text](image/多态/image.png)

## 多态构成的条件
**继承**中要构成**多态**必须要两个条件：


- 必须通过**基类的指针或者引用调用虚函数**。

- 被调用的函数必须是**虚函数**，并且派生类必须对基类的虚函数进行**重写**。
